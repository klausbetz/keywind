import{m as N}from"./assets/module.esm-9a996e1c.js";import{b as a}from"./assets/index-a7b84447.js";document.addEventListener("alpine:init",()=>{N.data("webAuthnRegister",function(){const{attestationObjectInput:m,authenticatorLabelInput:g,clientDataJSONInput:A,errorInput:u,publicKeyCredentialIdInput:I,registerForm:s,transportsInput:w}=this.$refs,{attestationConveyancePreference:c,authenticatorAttachment:l,challenge:C,createTimeout:p,excludeCredentialIds:K,requireResidentKey:d,rpEntityName:v,rpId:S,signatureAlgorithms:P,unsupportedBrowserText:R,userId:x,userVerificationRequirement:f,username:h}=this.$store.webAuthnRegister,E=t=>{const e=[];return t===""?(e.push({alg:-7,type:"public-key"}),e):(t.split(",").forEach(i=>{e.push({alg:parseInt(i),type:"public-key"})}),e)},L=t=>{const e=[];return t===""||t.split(",").forEach(i=>{e.push({id:a.parse(i,{loose:!0}),type:"public-key"})}),e},T=t=>{if(t===""||t.constructor!==Array)return"";let e="";return t.forEach(n=>{e+=n+","}),e.slice(0,-1)};return{registerSecurityKey:()=>{if(!window.PublicKeyCredential){u.value=R,s.submit();return}const t={challenge:a.parse(C,{loose:!0}),pubKeyCredParams:E(P),rp:{id:S,name:v},user:{displayName:h,id:a.parse(x,{loose:!0}),name:h}};c!=="not specified"&&(t.attestation=c);const e={};let n=!1;l!=="not specified"&&(e.authenticatorAttachment=l,n=!0),d!=="not specified"&&(d==="Yes"?e.requireResidentKey=!0:e.requireResidentKey=!1,n=!0),f!=="not specified"&&(e.userVerification=f,n=!0),n&&(t.authenticatorSelection=e);const i=L(K);i.length>0&&(t.excludeCredentials=i),parseInt(p)!==0&&(t.timeout=parseInt(p)*1e3),navigator.credentials.create({publicKey:t}).then(r=>{if(r instanceof PublicKeyCredential&&r.response instanceof AuthenticatorAttestationResponse){window.result=r;const q=r.rawId;if(m.value=a.stringify(new Uint8Array(r.response.attestationObject),{pad:!1}),A.value=a.stringify(new Uint8Array(r.response.clientDataJSON),{pad:!1}),I.value=a.stringify(new Uint8Array(q),{pad:!1}),typeof r.response.getTransports=="function"){const b=r.response.getTransports();b&&(w.value=T(b))}else console.log("Your browser is not able to recognize supported transport media for the authenticator.");const y="WebAuthn Authenticator (Default Label)";let o=window.prompt("Please input your registered authenticator's label",y);o===null&&(o=y),g.value=o,s.submit()}}).catch(function(r){u.value=r,s.submit()})}}})});
